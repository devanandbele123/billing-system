{"ast":null,"code":"// applyOffer.ts\n// ------------------------------------------------------------\n// This function calculates:\n//  - Item total after applying offer\n//  - Savings amount\n//  - Offer text message\n//\n// Each product may have its own offer rules.\n// Basket context is used for combo offers (e.g., Milk + Bread).\n// ------------------------------------------------------------\n\nexport const applyOffer = (productId, qty, price, basketProducts) => {\n  // Default values (no offer applied)\n  let finalPrice = qty * price;\n  let savings = 0;\n  let offer = \"No offer\";\n\n  // Helper: get quantity of another product from basket\n  const getQty = id => {\n    var _basketProducts$find$, _basketProducts$find;\n    return (_basketProducts$find$ = (_basketProducts$find = basketProducts.find(p => p.id === id)) === null || _basketProducts$find === void 0 ? void 0 : _basketProducts$find.qty) !== null && _basketProducts$find$ !== void 0 ? _basketProducts$find$ : 0;\n  };\n\n  // ------------------------------------------------------------\n  // ðŸŽ OFFER RULES FOR EACH PRODUCT\n  // ------------------------------------------------------------\n  switch (productId) {\n    // ------------------------------------------------------------\n    // ðŸ¥£ SOUP â†’ Buy 2 Get 1 Free\n    // For every 3 soups â†’ 1 soup is free\n    // ------------------------------------------------------------\n    case \"Soup\":\n      {\n        const freeSoups = Math.floor(qty / 3); // 1 free per group of 3\n        savings = freeSoups * price;\n        finalPrice = qty * price - savings;\n        offer = freeSoups > 0 ? `Buy 2 Get 1 Free (Free ${freeSoups})` : \"Buy 2 Get 1 Free\";\n        break;\n      }\n\n    // ------------------------------------------------------------\n    // ðŸ¥› MILK â†’ Combo offer with Bread\n    // (Discount is applied on Bread, not on Milk)\n    // ------------------------------------------------------------\n    case \"Milk\":\n      {\n        const milkQty = getQty(\"Milk\");\n        const breadQty = getQty(\"Bread\");\n        const combos = Math.min(milkQty, breadQty); // Number of valid combos\n\n        offer = combos > 0 ? `Combo: Milk + Bread (${combos})` : \"Buy Bread to unlock combo discount\";\n\n        // Milk price doesn't change; discount applies on Bread side\n        finalPrice = qty * price;\n        savings = 0;\n        break;\n      }\n\n    // ------------------------------------------------------------\n    // ðŸž BREAD â†’ Â£0.10 off for each Milk + Bread combo\n    // Example:\n    //   Milk: 2  & Bread: 3  â†’ combos = 2 â†’ save 20p\n    // ------------------------------------------------------------\n    case \"Bread\":\n      {\n        const milkQty = getQty(\"Milk\");\n        const breadQty = getQty(\"Bread\");\n        const combos = Math.min(milkQty, breadQty);\n        savings = combos * 0.1; // Â£0.10 per combo\n        finalPrice = qty * price - savings;\n        offer = combos > 0 ? `Combo: Milk + Bread (${combos})` : \"Buy Milk to unlock combo discount\";\n        break;\n      }\n\n    // ------------------------------------------------------------\n    // ðŸ§ˆ BUTTER â†’ Flat 5% discount\n    // ------------------------------------------------------------\n    case \"Butter\":\n      {\n        savings = qty * price * 0.05; // 5% off\n        finalPrice = qty * price - savings;\n        offer = \"5% off Butter\";\n        break;\n      }\n\n    // ------------------------------------------------------------\n    // ðŸ§€ Other products â†’ No offer\n    // ------------------------------------------------------------\n    default:\n      offer = \"No offer\";\n      savings = 0;\n      finalPrice = qty * price;\n  }\n\n  // ------------------------------------------------------------\n  // Round values safely to 2 decimals (important for money)\n  // ------------------------------------------------------------\n  const round = n => Math.round((n + Number.EPSILON) * 100) / 100;\n  return {\n    itemCost: round(finalPrice),\n    savings: round(savings),\n    offer\n  };\n};","map":{"version":3,"names":["applyOffer","productId","qty","price","basketProducts","finalPrice","savings","offer","getQty","id","_basketProducts$find$","_basketProducts$find","find","p","freeSoups","Math","floor","milkQty","breadQty","combos","min","round","n","Number","EPSILON","itemCost"],"sources":["C:/Users/devan/OneDrive/Desktop/BillingSys/billing-system-app/src/offers/applyOffers.ts"],"sourcesContent":["// applyOffer.ts\r\n// ------------------------------------------------------------\r\n// This function calculates:\r\n//  - Item total after applying offer\r\n//  - Savings amount\r\n//  - Offer text message\r\n//\r\n// Each product may have its own offer rules.\r\n// Basket context is used for combo offers (e.g., Milk + Bread).\r\n// ------------------------------------------------------------\r\n\r\nimport { BasketProduct, OfferResult } from \"../types\";\r\n\r\nexport const applyOffer = (\r\n  productId: string,\r\n  qty: number,\r\n  price: number,\r\n  basketProducts: BasketProduct[]\r\n): OfferResult => {\r\n  \r\n  // Default values (no offer applied)\r\n  let finalPrice = qty * price;\r\n  let savings = 0;\r\n  let offer = \"No offer\";\r\n\r\n  // Helper: get quantity of another product from basket\r\n  const getQty = (id: string) =>\r\n    basketProducts.find((p) => p.id === id)?.qty ?? 0;\r\n\r\n  // ------------------------------------------------------------\r\n  // ðŸŽ OFFER RULES FOR EACH PRODUCT\r\n  // ------------------------------------------------------------\r\n  switch (productId) {\r\n\r\n    // ------------------------------------------------------------\r\n    // ðŸ¥£ SOUP â†’ Buy 2 Get 1 Free\r\n    // For every 3 soups â†’ 1 soup is free\r\n    // ------------------------------------------------------------\r\n    case \"Soup\": {\r\n      const freeSoups = Math.floor(qty / 3); // 1 free per group of 3\r\n      savings = freeSoups * price;\r\n      finalPrice = qty * price - savings;\r\n\r\n      offer =\r\n        freeSoups > 0\r\n          ? `Buy 2 Get 1 Free (Free ${freeSoups})`\r\n          : \"Buy 2 Get 1 Free\";\r\n\r\n      break;\r\n    }\r\n\r\n    // ------------------------------------------------------------\r\n    // ðŸ¥› MILK â†’ Combo offer with Bread\r\n    // (Discount is applied on Bread, not on Milk)\r\n    // ------------------------------------------------------------\r\n    case \"Milk\": {\r\n      const milkQty = getQty(\"Milk\");\r\n      const breadQty = getQty(\"Bread\");\r\n      const combos = Math.min(milkQty, breadQty); // Number of valid combos\r\n\r\n      offer =\r\n        combos > 0\r\n          ? `Combo: Milk + Bread (${combos})`\r\n          : \"Buy Bread to unlock combo discount\";\r\n\r\n      // Milk price doesn't change; discount applies on Bread side\r\n      finalPrice = qty * price;\r\n      savings = 0;\r\n      break;\r\n    }\r\n\r\n    // ------------------------------------------------------------\r\n    // ðŸž BREAD â†’ Â£0.10 off for each Milk + Bread combo\r\n    // Example:\r\n    //   Milk: 2  & Bread: 3  â†’ combos = 2 â†’ save 20p\r\n    // ------------------------------------------------------------\r\n    case \"Bread\": {\r\n      const milkQty = getQty(\"Milk\");\r\n      const breadQty = getQty(\"Bread\");\r\n      const combos = Math.min(milkQty, breadQty);\r\n\r\n      savings = combos * 0.1; // Â£0.10 per combo\r\n      finalPrice = qty * price - savings;\r\n\r\n      offer =\r\n        combos > 0\r\n          ? `Combo: Milk + Bread (${combos})`\r\n          : \"Buy Milk to unlock combo discount\";\r\n\r\n      break;\r\n    }\r\n\r\n    // ------------------------------------------------------------\r\n    // ðŸ§ˆ BUTTER â†’ Flat 5% discount\r\n    // ------------------------------------------------------------\r\n    case \"Butter\": {\r\n      savings = qty * price * 0.05; // 5% off\r\n      finalPrice = qty * price - savings;\r\n      offer = \"5% off Butter\";\r\n      break;\r\n    }\r\n\r\n    // ------------------------------------------------------------\r\n    // ðŸ§€ Other products â†’ No offer\r\n    // ------------------------------------------------------------\r\n    default:\r\n      offer = \"No offer\";\r\n      savings = 0;\r\n      finalPrice = qty * price;\r\n  }\r\n\r\n  // ------------------------------------------------------------\r\n  // Round values safely to 2 decimals (important for money)\r\n  // ------------------------------------------------------------\r\n  const round = (n: number) =>\r\n    Math.round((n + Number.EPSILON) * 100) / 100;\r\n\r\n  return {\r\n    itemCost: round(finalPrice),\r\n    savings: round(savings),\r\n    offer,\r\n  };\r\n};\r\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAIA,OAAO,MAAMA,UAAU,GAAGA,CACxBC,SAAiB,EACjBC,GAAW,EACXC,KAAa,EACbC,cAA+B,KACf;EAEhB;EACA,IAAIC,UAAU,GAAGH,GAAG,GAAGC,KAAK;EAC5B,IAAIG,OAAO,GAAG,CAAC;EACf,IAAIC,KAAK,GAAG,UAAU;;EAEtB;EACA,MAAMC,MAAM,GAAIC,EAAU;IAAA,IAAAC,qBAAA,EAAAC,oBAAA;IAAA,QAAAD,qBAAA,IAAAC,oBAAA,GACxBP,cAAc,CAACQ,IAAI,CAAEC,CAAC,IAAKA,CAAC,CAACJ,EAAE,KAAKA,EAAE,CAAC,cAAAE,oBAAA,uBAAvCA,oBAAA,CAAyCT,GAAG,cAAAQ,qBAAA,cAAAA,qBAAA,GAAI,CAAC;EAAA;;EAEnD;EACA;EACA;EACA,QAAQT,SAAS;IAEf;IACA;IACA;IACA;IACA,KAAK,MAAM;MAAE;QACX,MAAMa,SAAS,GAAGC,IAAI,CAACC,KAAK,CAACd,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC;QACvCI,OAAO,GAAGQ,SAAS,GAAGX,KAAK;QAC3BE,UAAU,GAAGH,GAAG,GAAGC,KAAK,GAAGG,OAAO;QAElCC,KAAK,GACHO,SAAS,GAAG,CAAC,GACT,0BAA0BA,SAAS,GAAG,GACtC,kBAAkB;QAExB;MACF;;IAEA;IACA;IACA;IACA;IACA,KAAK,MAAM;MAAE;QACX,MAAMG,OAAO,GAAGT,MAAM,CAAC,MAAM,CAAC;QAC9B,MAAMU,QAAQ,GAAGV,MAAM,CAAC,OAAO,CAAC;QAChC,MAAMW,MAAM,GAAGJ,IAAI,CAACK,GAAG,CAACH,OAAO,EAAEC,QAAQ,CAAC,CAAC,CAAC;;QAE5CX,KAAK,GACHY,MAAM,GAAG,CAAC,GACN,wBAAwBA,MAAM,GAAG,GACjC,oCAAoC;;QAE1C;QACAd,UAAU,GAAGH,GAAG,GAAGC,KAAK;QACxBG,OAAO,GAAG,CAAC;QACX;MACF;;IAEA;IACA;IACA;IACA;IACA;IACA,KAAK,OAAO;MAAE;QACZ,MAAMW,OAAO,GAAGT,MAAM,CAAC,MAAM,CAAC;QAC9B,MAAMU,QAAQ,GAAGV,MAAM,CAAC,OAAO,CAAC;QAChC,MAAMW,MAAM,GAAGJ,IAAI,CAACK,GAAG,CAACH,OAAO,EAAEC,QAAQ,CAAC;QAE1CZ,OAAO,GAAGa,MAAM,GAAG,GAAG,CAAC,CAAC;QACxBd,UAAU,GAAGH,GAAG,GAAGC,KAAK,GAAGG,OAAO;QAElCC,KAAK,GACHY,MAAM,GAAG,CAAC,GACN,wBAAwBA,MAAM,GAAG,GACjC,mCAAmC;QAEzC;MACF;;IAEA;IACA;IACA;IACA,KAAK,QAAQ;MAAE;QACbb,OAAO,GAAGJ,GAAG,GAAGC,KAAK,GAAG,IAAI,CAAC,CAAC;QAC9BE,UAAU,GAAGH,GAAG,GAAGC,KAAK,GAAGG,OAAO;QAClCC,KAAK,GAAG,eAAe;QACvB;MACF;;IAEA;IACA;IACA;IACA;MACEA,KAAK,GAAG,UAAU;MAClBD,OAAO,GAAG,CAAC;MACXD,UAAU,GAAGH,GAAG,GAAGC,KAAK;EAC5B;;EAEA;EACA;EACA;EACA,MAAMkB,KAAK,GAAIC,CAAS,IACtBP,IAAI,CAACM,KAAK,CAAC,CAACC,CAAC,GAAGC,MAAM,CAACC,OAAO,IAAI,GAAG,CAAC,GAAG,GAAG;EAE9C,OAAO;IACLC,QAAQ,EAAEJ,KAAK,CAAChB,UAAU,CAAC;IAC3BC,OAAO,EAAEe,KAAK,CAACf,OAAO,CAAC;IACvBC;EACF,CAAC;AACH,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}