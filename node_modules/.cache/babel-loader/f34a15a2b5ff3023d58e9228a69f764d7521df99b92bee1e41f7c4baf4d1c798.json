{"ast":null,"code":"// applyOffer.ts\n\n/**\r\n * applyOffer - calculates cost and savings for a single product given basket context\r\n *\r\n * @param productId\r\n * @param qty\r\n * @param price\r\n * @param basketProducts - array of products in basket with qty & price\r\n */\nexport const applyOffer = (productId, qty, price, basketProducts) => {\n  let finalPrice = qty * price;\n  let savings = 0;\n  let offer = \"No offer\";\n  const quantity = id => {\n    var _basketProducts$find$, _basketProducts$find;\n    return (_basketProducts$find$ = (_basketProducts$find = basketProducts.find(p => p.id === id)) === null || _basketProducts$find === void 0 ? void 0 : _basketProducts$find.qty) !== null && _basketProducts$find$ !== void 0 ? _basketProducts$find$ : 0;\n  };\n  switch (productId) {\n    case \"Soup\":\n      {\n        // Buy 2 get 1 free -> for every 3 soups, 1 is free (i.e. pay for 2)\n        const free = Math.floor(qty / 3);\n        savings = free * price;\n        finalPrice = qty * price - savings;\n        offer = free > 0 ? `Buy 2 Get 1 Free (free ${free})` : \"Buy 2 Get 1 Free\";\n        break;\n      }\n    case \"Milk\":\n      {\n        // Combo with Bread — saving comes from Bread side (we still show combo note)\n        const milkQty = quantity(\"Milk\");\n        const breadQty = quantity(\"Bread\");\n        const combos = Math.min(milkQty, breadQty);\n        offer = combos > 0 ? `Combo: Milk + Bread (${combos})` : \"Add Bread to get combo discount\";\n        // No price change here — bread side applies discount\n        finalPrice = qty * price;\n        savings = 0;\n        break;\n      }\n    case \"Bread\":\n      {\n        // For each pair Milk+Bread give £0.10 off bread (per combo)\n        const milkQty = quantity(\"Milk\");\n        const breadQty = quantity(\"Bread\");\n        const combos = Math.min(milkQty, breadQty);\n        savings = combos * 0.1;\n        finalPrice = qty * price - savings;\n        offer = combos > 0 ? `Combo: Milk + Bread (${combos})` : \"Add Milk to unlock combo discount\";\n        break;\n      }\n    case \"Butter\":\n      {\n        // 5% off butter\n        savings = qty * price * 0.05;\n        finalPrice = qty * price - savings;\n        offer = \"5% off Butter\";\n        break;\n      }\n    default:\n      {\n        finalPrice = qty * price;\n        savings = 0;\n        offer = \"No offer\";\n      }\n  }\n\n  // safe rounding to 2 decimals\n  const round = n => Math.round((n + Number.EPSILON) * 100) / 100;\n  return {\n    itemCost: round(finalPrice),\n    savings: round(savings),\n    offer\n  };\n};","map":{"version":3,"names":["applyOffer","productId","qty","price","basketProducts","finalPrice","savings","offer","quantity","id","_basketProducts$find$","_basketProducts$find","find","p","free","Math","floor","milkQty","breadQty","combos","min","round","n","Number","EPSILON","itemCost"],"sources":["C:/Users/devan/OneDrive/Desktop/BillingSys/billing-system-app/src/offers/applyOffers.ts"],"sourcesContent":["// applyOffer.ts\r\nimport { BasketProduct, OfferResult } from \"../types\";\r\n\r\n/**\r\n * applyOffer - calculates cost and savings for a single product given basket context\r\n *\r\n * @param productId\r\n * @param qty\r\n * @param price\r\n * @param basketProducts - array of products in basket with qty & price\r\n */\r\nexport const applyOffer = (\r\n  productId: string,\r\n  qty: number,\r\n  price: number,\r\n  basketProducts: BasketProduct[]\r\n): OfferResult => {\r\n  let finalPrice = qty * price;\r\n  let savings = 0;\r\n  let offer = \"No offer\";\r\n\r\n  const quantity = (id: string) => basketProducts.find((p) => p.id === id)?.qty ?? 0;\r\n\r\n  switch (productId) {\r\n    case \"Soup\": {\r\n      // Buy 2 get 1 free -> for every 3 soups, 1 is free (i.e. pay for 2)\r\n      const free = Math.floor(qty / 3);\r\n      savings = free * price;\r\n      finalPrice = qty * price - savings;\r\n      offer = free > 0 ? `Buy 2 Get 1 Free (free ${free})` : \"Buy 2 Get 1 Free\";\r\n      break;\r\n    }\r\n\r\n    case \"Milk\": {\r\n      // Combo with Bread — saving comes from Bread side (we still show combo note)\r\n      const milkQty = quantity(\"Milk\");\r\n      const breadQty = quantity(\"Bread\");\r\n      const combos = Math.min(milkQty, breadQty);\r\n      offer = combos > 0 ? `Combo: Milk + Bread (${combos})` : \"Add Bread to get combo discount\";\r\n      // No price change here — bread side applies discount\r\n      finalPrice = qty * price;\r\n      savings = 0;\r\n      break;\r\n    }\r\n\r\n    case \"Bread\": {\r\n      // For each pair Milk+Bread give £0.10 off bread (per combo)\r\n      const milkQty = quantity(\"Milk\");\r\n      const breadQty = quantity(\"Bread\");\r\n      const combos = Math.min(milkQty, breadQty);\r\n      savings = combos * 0.1;\r\n      finalPrice = qty * price - savings;\r\n      offer = combos > 0 ? `Combo: Milk + Bread (${combos})` : \"Add Milk to unlock combo discount\";\r\n      break;\r\n    }\r\n\r\n    case \"Butter\": {\r\n      // 5% off butter\r\n      savings = qty * price * 0.05;\r\n      finalPrice = qty * price - savings;\r\n      offer = \"5% off Butter\";\r\n      break;\r\n    }\r\n\r\n    default: {\r\n      finalPrice = qty * price;\r\n      savings = 0;\r\n      offer = \"No offer\";\r\n    }\r\n  }\r\n\r\n  // safe rounding to 2 decimals\r\n  const round = (n: number) => Math.round((n + Number.EPSILON) * 100) / 100;\r\n\r\n  return { itemCost: round(finalPrice), savings: round(savings), offer };\r\n};\r\n"],"mappings":"AAAA;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,MAAMA,UAAU,GAAGA,CACxBC,SAAiB,EACjBC,GAAW,EACXC,KAAa,EACbC,cAA+B,KACf;EAChB,IAAIC,UAAU,GAAGH,GAAG,GAAGC,KAAK;EAC5B,IAAIG,OAAO,GAAG,CAAC;EACf,IAAIC,KAAK,GAAG,UAAU;EAEtB,MAAMC,QAAQ,GAAIC,EAAU;IAAA,IAAAC,qBAAA,EAAAC,oBAAA;IAAA,QAAAD,qBAAA,IAAAC,oBAAA,GAAKP,cAAc,CAACQ,IAAI,CAAEC,CAAC,IAAKA,CAAC,CAACJ,EAAE,KAAKA,EAAE,CAAC,cAAAE,oBAAA,uBAAvCA,oBAAA,CAAyCT,GAAG,cAAAQ,qBAAA,cAAAA,qBAAA,GAAI,CAAC;EAAA;EAElF,QAAQT,SAAS;IACf,KAAK,MAAM;MAAE;QACX;QACA,MAAMa,IAAI,GAAGC,IAAI,CAACC,KAAK,CAACd,GAAG,GAAG,CAAC,CAAC;QAChCI,OAAO,GAAGQ,IAAI,GAAGX,KAAK;QACtBE,UAAU,GAAGH,GAAG,GAAGC,KAAK,GAAGG,OAAO;QAClCC,KAAK,GAAGO,IAAI,GAAG,CAAC,GAAG,0BAA0BA,IAAI,GAAG,GAAG,kBAAkB;QACzE;MACF;IAEA,KAAK,MAAM;MAAE;QACX;QACA,MAAMG,OAAO,GAAGT,QAAQ,CAAC,MAAM,CAAC;QAChC,MAAMU,QAAQ,GAAGV,QAAQ,CAAC,OAAO,CAAC;QAClC,MAAMW,MAAM,GAAGJ,IAAI,CAACK,GAAG,CAACH,OAAO,EAAEC,QAAQ,CAAC;QAC1CX,KAAK,GAAGY,MAAM,GAAG,CAAC,GAAG,wBAAwBA,MAAM,GAAG,GAAG,iCAAiC;QAC1F;QACAd,UAAU,GAAGH,GAAG,GAAGC,KAAK;QACxBG,OAAO,GAAG,CAAC;QACX;MACF;IAEA,KAAK,OAAO;MAAE;QACZ;QACA,MAAMW,OAAO,GAAGT,QAAQ,CAAC,MAAM,CAAC;QAChC,MAAMU,QAAQ,GAAGV,QAAQ,CAAC,OAAO,CAAC;QAClC,MAAMW,MAAM,GAAGJ,IAAI,CAACK,GAAG,CAACH,OAAO,EAAEC,QAAQ,CAAC;QAC1CZ,OAAO,GAAGa,MAAM,GAAG,GAAG;QACtBd,UAAU,GAAGH,GAAG,GAAGC,KAAK,GAAGG,OAAO;QAClCC,KAAK,GAAGY,MAAM,GAAG,CAAC,GAAG,wBAAwBA,MAAM,GAAG,GAAG,mCAAmC;QAC5F;MACF;IAEA,KAAK,QAAQ;MAAE;QACb;QACAb,OAAO,GAAGJ,GAAG,GAAGC,KAAK,GAAG,IAAI;QAC5BE,UAAU,GAAGH,GAAG,GAAGC,KAAK,GAAGG,OAAO;QAClCC,KAAK,GAAG,eAAe;QACvB;MACF;IAEA;MAAS;QACPF,UAAU,GAAGH,GAAG,GAAGC,KAAK;QACxBG,OAAO,GAAG,CAAC;QACXC,KAAK,GAAG,UAAU;MACpB;EACF;;EAEA;EACA,MAAMc,KAAK,GAAIC,CAAS,IAAKP,IAAI,CAACM,KAAK,CAAC,CAACC,CAAC,GAAGC,MAAM,CAACC,OAAO,IAAI,GAAG,CAAC,GAAG,GAAG;EAEzE,OAAO;IAAEC,QAAQ,EAAEJ,KAAK,CAAChB,UAAU,CAAC;IAAEC,OAAO,EAAEe,KAAK,CAACf,OAAO,CAAC;IAAEC;EAAM,CAAC;AACxE,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}